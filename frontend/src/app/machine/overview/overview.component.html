<div class="min-h-screen bg-gray-900 text-white p-8">
  <h1 class="text-2xl font-bold mb-8">Machine Overview</h1>

  <!-- Controls -->
  <div class="max-w-3xl mx-auto mb-6 flex gap-3">
    <button
      (click)="machine.tick()"
      [disabled]="machine.running()"
      class="px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-700 disabled:text-gray-500 rounded font-semibold text-sm">
      Step
    </button>
    <button
      (click)="machine.start()"
      [disabled]="machine.running()"
      class="px-4 py-2 bg-green-600 hover:bg-green-500 disabled:bg-gray-700 disabled:text-gray-500 rounded font-semibold text-sm">
      Start
    </button>
    <button
      (click)="machine.stop()"
      [disabled]="!machine.running()"
      class="px-4 py-2 bg-yellow-600 hover:bg-yellow-500 disabled:bg-gray-700 disabled:text-gray-500 rounded font-semibold text-sm">
      Stop
    </button>
    <button
      (click)="machine.reset()"
      class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded font-semibold text-sm">
      Reset
    </button>
  </div>

  <!-- Loop Diagram -->
  <div class="max-w-3xl mx-auto mb-8">
    <!-- Top row: De-nesting → Capping -->
    <div class="flex items-center justify-between mb-2">
      <a routerLink="/station/de-nesting" class="bg-gray-800 rounded-lg p-4 w-48 min-h-24 border border-gray-700 hover:border-blue-500 cursor-pointer block">
        <div class="text-xs text-gray-400 mb-1">Station 1</div>
        <div class="font-semibold">De-nesting</div>
        @for (m of moversAt('de-nesting'); track m.id) {
          <div class="mt-1">
            <span [class]="moverClass(m)">{{ m.id }}</span>
          </div>
        }
      </a>

      <!-- Top arrow -->
      <div class="flex-1 flex items-center justify-center px-4">
        <div class="h-0.5 flex-1 bg-gray-600"></div>
        <div class="text-gray-500 mx-2">&rarr;</div>
        <div class="h-0.5 flex-1 bg-gray-600"></div>
      </div>

      <a routerLink="/station/capping" class="bg-gray-800 rounded-lg p-4 w-48 min-h-24 border border-gray-700 hover:border-blue-500 cursor-pointer block">
        <div class="text-xs text-gray-400 mb-1">Station 2</div>
        <div class="font-semibold">Capping</div>
        @for (m of moversAt('capping'); track m.id) {
          <div class="mt-1">
            <span [class]="moverClass(m)">{{ m.id }}</span>
          </div>
        }
      </a>
    </div>

    <!-- Side connectors -->
    <div class="flex justify-between px-16">
      <div class="flex flex-col items-center">
        <div class="w-0.5 h-12 bg-gray-600"></div>
        <div class="text-gray-500">&uarr;</div>
      </div>
      <div class="flex flex-col items-center">
        <div class="text-gray-500">&darr;</div>
        <div class="w-0.5 h-12 bg-gray-600"></div>
      </div>
    </div>

    <!-- Bottom row: Packing ← Reject -->
    <div class="flex items-center justify-between mt-2">
      <a routerLink="/station/packing" class="bg-gray-800 rounded-lg p-4 w-48 min-h-24 border border-gray-700 hover:border-blue-500 cursor-pointer block">
        <div class="text-xs text-gray-400 mb-1">Station 4</div>
        <div class="font-semibold">Packing</div>
        @for (m of moversAt('packing'); track m.id) {
          <div class="mt-1">
            <span [class]="moverClass(m)">{{ m.id }}</span>
          </div>
        }
      </a>

      <!-- Bottom arrow -->
      <div class="flex-1 flex items-center justify-center px-4">
        <div class="h-0.5 flex-1 bg-gray-600"></div>
        <div class="text-gray-500 mx-2">&larr;</div>
        <div class="h-0.5 flex-1 bg-gray-600"></div>
      </div>

      <a routerLink="/station/reject" class="bg-gray-800 rounded-lg p-4 w-48 min-h-24 border border-gray-700 hover:border-blue-500 cursor-pointer block">
        <div class="text-xs text-gray-400 mb-1">Station 3</div>
        <div class="font-semibold">Reject</div>
        @for (m of moversAt('reject'); track m.id) {
          <div class="mt-1">
            <span [class]="moverClass(m)">{{ m.id }}</span>
          </div>
        }
      </a>
    </div>
  </div>

  <!-- Transit movers -->
  <div class="max-w-3xl mx-auto mb-8">
    <h2 class="text-sm text-gray-400 mb-2">In Transit</h2>
    <div class="flex flex-wrap gap-2">
      @for (m of moversAt(null); track m.id) {
        <span [class]="moverClass(m)">{{ m.id }}</span>
      }
      @if (moversAt(null).length === 0) {
        <span class="text-gray-600 text-sm">None</span>
      }
    </div>
  </div>

  <!-- Nest & Stats -->
  <div class="max-w-3xl mx-auto flex gap-8">
    <!-- Nest indicator -->
    <div class="bg-gray-800 rounded-lg p-4 flex-1">
      <h2 class="text-sm text-gray-400 mb-2">Nest</h2>
      <div class="text-3xl font-bold">
        {{ machine.nest().pensRemaining }}<span class="text-gray-500">/8</span>
      </div>
      <div class="text-sm text-gray-400 mt-1">
        Nests used: {{ machine.nest().totalNestsUsed }}
      </div>
    </div>

    <!-- Stats panel -->
    <div class="bg-gray-800 rounded-lg p-4 flex-1">
      <h2 class="text-sm text-gray-400 mb-2">Stats</h2>
      <div class="flex gap-8">
        <div>
          <div class="text-2xl font-bold text-green-400">{{ machine.stats().produced }}</div>
          <div class="text-sm text-gray-400">Produced</div>
        </div>
        <div>
          <div class="text-2xl font-bold text-red-400">{{ machine.stats().rejected }}</div>
          <div class="text-sm text-gray-400">Rejected</div>
        </div>
      </div>
    </div>
  </div>
</div>
