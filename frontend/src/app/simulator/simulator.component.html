<div class="m-14 flex items-start gap-8">
  <div class="w-40">
    <button
      (click)="toggle()"
      class="px-4 py-1.5 border border-gray-400 rounded bg-white cursor-pointer hover:bg-gray-100 active:bg-gray-200"
    >
      {{ snapped() ? 'Reset' : 'Snap Cap' }}
    </button>

    <button
      (click)="downloadPng()"
      class="mt-2 px-4 py-1.5 border border-gray-400 rounded bg-white cursor-pointer hover:bg-gray-100 active:bg-gray-200"
    >
      Download PNG
    </button>

    <label class="mt-4 block text-sm">Cap position: {{ capPercent() }}%</label>
    <input
      type="range"
      [min]="CAP_POSITION_MIN"
      [max]="CAP_POSITION_MAX"
      [value]="capPercent()"
      (input)="onSliderInput($event)"
      class="w-full mt-1"
    />

    <label class="mt-4 block text-sm">Pen tilt: {{ penTilt() }}&deg;</label>
    <input
      type="range"
      [min]="TILT_MIN"
      [max]="TILT_MAX"
      [step]="TILT_STEP"
      [value]="penTilt()"
      (input)="onTiltInput($event)"
      class="w-full mt-1"
    />

    <label class="mt-4 block text-sm">Mover tilt: {{ moverTilt() }}&deg;</label>
    <input
      type="range"
      [min]="MOVER_TILT_MIN"
      [max]="MOVER_TILT_MAX"
      [step]="MOVER_TILT_STEP"
      [value]="moverTilt()"
      (input)="onMoverTiltInput($event)"
      class="w-full mt-1"
    />

    <label class="mt-4 block text-sm">Mover #: {{ moverNumber() }}</label>
    <input
      type="range"
      [min]="MOVER_NUMBER_MIN"
      [max]="MOVER_NUMBER_MAX"
      step="1"
      [value]="moverNumber()"
      (input)="onMoverNumberInput($event)"
      class="w-full mt-1"
    />

    <label class="mt-4 block text-sm">Pen X: {{ penOffsetX() }}px</label>
    <input
      type="range"
      [min]="OFFSET_MIN"
      [max]="OFFSET_MAX"
      [value]="penOffsetX()"
      (input)="onPenOffsetInput('x', $event)"
      class="w-full mt-1"
    />

    <label class="mt-2 block text-sm">Pen Y: {{ penOffsetY() }}px</label>
    <input
      type="range"
      [min]="OFFSET_MIN"
      [max]="OFFSET_MAX"
      [value]="penOffsetY()"
      (input)="onPenOffsetInput('y', $event)"
      class="w-full mt-1"
    />

    <label class="mt-4 block text-sm">Cap X: {{ capOffsetX() }}px</label>
    <input
      type="range"
      [min]="OFFSET_MIN"
      [max]="OFFSET_MAX"
      [value]="capOffsetX()"
      (input)="onCapOffsetInput('x', $event)"
      class="w-full mt-1"
    />

    <label class="mt-2 block text-sm">Cap Y: {{ capOffsetY() }}px</label>
    <input
      type="range"
      [min]="OFFSET_MIN"
      [max]="OFFSET_MAX"
      [value]="capOffsetY()"
      (input)="onCapOffsetInput('y', $event)"
      class="w-full mt-1"
    />
  </div>

  <div
    class="overflow-hidden"
    [style.width.px]="640 * VISUAL_SCALE"
    [style.height.px]="2420 * VISUAL_SCALE"
  >
    <div
      class="relative border border-dashed border-gray-400 origin-top-left"
      style="width: 640px; height: 2420px"
      [style.transform]="'scale(' + VISUAL_SCALE + ')'"
    >
      <app-cap
        class="block absolute left-[60px] top-0 z-20"
        [style.opacity]="CAP_OPACITY"
        [style.transform]="
          'translate(' + capOffsetX() + 'px,' + (capTranslateY() + capOffsetY()) + 'px)'
        "
      />
      <div
        class="absolute left-[90px] top-[520px]"
        style="transform-origin: 225px 900px"
        [style.transform]="
          'translate(' + penOffsetX() + 'px,' + penOffsetY() + 'px) rotate(' + moverTilt() + 'deg)'
        "
      >
        <app-pen
          class="block relative"
          style="transform-origin: 225px 900px"
          [style.transform]="'rotate(' + penTilt() + 'deg)'"
        />
        <app-mover
          class="block absolute z-10"
          style="left: -45px; top: 1200px"
          [moverNumber]="moverNumber()"
        />
      </div>
    </div>
  </div>

  <div>
    <div class="text-sm font-semibold">Overlap</div>
    <div class="text-2xl">{{ overlapPixelCount() }}</div>
    <div class="text-xs text-gray-500 mb-4">pixels</div>
    <app-overlap-graph [dataPoints]="overlapHistory()" />
  </div>
</div>
